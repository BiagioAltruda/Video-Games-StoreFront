<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Payment Page</title>
   <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome (icone) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../styles/StoreFrontStyleSheet.css" />
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg main-color-1 py-3">
      <div class="container">
          <a class="navbar-brand fw-bold" href="home.html">
              <i class="fas fa-home me-2"></i>Payment for game
          </a>
      </div>
  </nav>

  <!-- Transaction Details Section -->
  <div class="container mt-4">
      <h2 class="text-lg font-semibold">Transaction Details</h2>
      <p><strong>Transaction ID:</strong> <span th:text="${transaction.id}"></span></p>
      <p><strong>Player:</strong> <span th:text="${transaction.player.name}"></span></p>
      <p><strong>Game:</strong> <span th:text="${transaction.game.title}"></span></p>
      <p><strong>Price Paid:</strong> <span th:text="${transaction.pricePaid}"></span> €</p>
      <p><strong>Date:</strong> <span th:text="${#dates.format(transaction.date, 'yyyy-MM-dd HH:mm')}"></span></p>
  </div>

  <!-- Payment Form Section -->
  <div class="container mt-4">
      <form id="paymentForm" th:action="@{'/transactions/pay/' + ${transaction.id}}" method="post">
          <h2 class="text-lg font-semibold">Payment Details</h2>
          
          <div class="mb-3">
              <label for="cardholderName" class="form-label">Cardholder's Name</label>
              <input type="text" id="cardholderName" name="cardholderName" class="form-control" required>
          </div>

          <div class="mb-3">
              <label for="cardNumber" class="form-label">Card Number</label>
              <input type="text" id="cardNumber" name="cardNumber" class="form-control" required placeholder="1234 5678 9012 3456">
          </div>

          <div class="mb-3">
              <label for="expirationDate" class="form-label">Expiration Date</label>
              <input type="text" id="expirationDate" name="expirationDate" class="form-control" required placeholder="MM/YY">
          </div>

          <div class="mb-3">
              <label for="cvv" class="form-label">CVV</label>
              <input type="text" id="cvv" name="cvv" class="form-control" required placeholder="123">
          </div>

          <button type="submit" class="btn btn-primary w-100">Confirm Payment</button>
      </form>
  </div>

  <!-- Scripts Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>

  <!-- Script per alert pagamento -->
  <script>
    document.getElementById("paymentForm").addEventListener("submit", async function(e) {
      e.preventDefault(); // blocca l'invio normale del form

      const url = this.getAttribute("action"); // prende l'URL del th:action
      const formData = new FormData(this);

      try {
        const response = await fetch(url, {
          method: "POST",
          body: formData
        });

        const message = await response.text(); // risposta del backend
        alert(message); // mostro popup con l’esito

      } catch (error) {
        alert("Errore durante il pagamento. Riprova.");
      }
    });
  </script>
</body>
</html>